<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Body Fat & Muscle Predictor</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .container { max-width: 500px; margin: auto; text-align: center; }
    input[type="file"] { margin: 20px 0; }
    img { max-width: 100%; margin: 10px 0; }
    .result { margin-top: 20px; font-size: 1.2em; font-weight: bold; }
    .log { margin-top: 10px; font-size: 0.9em; color: gray; text-align: left; }
</style>
</head>
<body>
<div class="container">
    <h1>Body Fat & Muscle Predictor</h1>
    <input type="file" id="imageInput" accept="image/*">
    <br>
    <button onclick="predict()">Predict</button>
    <div id="preview"></div>
    <div class="result" id="result"></div>
    <div class="log" id="log"></div>
</div>

<script>
const previewDiv = document.getElementById('preview');
const resultDiv = document.getElementById('result');
const logDiv = document.getElementById('log');
const imageInput = document.getElementById('imageInput');

// إضافة لوج
function log(message) {
    console.log(message);
    logDiv.innerHTML += message + "<br>";
}

// عرض الصورة عند اختيارها
imageInput.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            previewDiv.innerHTML = `<img src="${e.target.result}" alt="Selected Image">`;
            log(`Image selected: ${file.name}, size: ${file.size} bytes`);
        }
        reader.readAsDataURL(file);
    } else {
        previewDiv.innerHTML = "";
    }
});

// إرسال الصورة للـ API
async function predict() {
    const file = imageInput.files[0];
    if (!file) {
        alert("Please select an image first.");
        return;
    }

    resultDiv.textContent = "Uploading image...";
    log("Uploading image to API...");

    const formData = new FormData();
    formData.append("file", file);

    try {
        const response = await fetch("https://bodyfat-cv.onrender.com/predict", {
            method: "POST",
            body: formData
        });

        log(`Response status: ${response.status}`);
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Prediction failed. Response: ${errorText}`);
        }

        const data = await response.json();
        log("Prediction result received:");
        log(JSON.stringify(data));

        resultDiv.innerHTML = `
            Body Fat: ${data.body_fat_percentage}%<br>
            Muscle: ${data.muscle_percentage}%
        `;
    } catch (error) {
        console.error("Error during prediction:", error);
        resultDiv.textContent = "Error: " + error.message;
        log("Error: " + error.message);
    }
}
</script>
</body>
</html>
